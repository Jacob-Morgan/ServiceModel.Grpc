name: CI

on:
  push:
    branches: [ master ]
    paths-ignore:
      - 'docs/**'
      - 'Examples/**'
      - '**.md'
  pull_request:
    branches: [ master ]
    paths-ignore:
      - 'docs/**'
      - 'Examples/**'
      - '**.md'

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2

    - name: Install net5.0
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: '5.0.100-rc.2.20464.8'

    - name: Install ThirdPartyLibraries
      shell: cmd
      run: dotnet tool install --global ThirdPartyLibraries.GlobalTool

    - name: Build
      shell: pwsh
      run: .\Build\step-build.ps1

    - name: ThirdPartyNotices
      shell: pwsh
      run: .\Build\step-third-party-notices.ps1

    - name: Unit test net461
      shell: pwsh
      run: .\Build\step-unit-test.ps1 net461

    - name: Unit test netcoreapp2.1
      shell: pwsh
      run: .\Build\step-unit-test.ps1 netcoreapp2.1

    - name: Unit test netcoreapp3.1
      shell: pwsh
      run: .\Build\step-unit-test.ps1 netcoreapp3.1

    - name: Unit test net5.0
      shell: pwsh
      run: .\Build\step-unit-test.ps1 net5.0

    - name: Pack
      shell: pwsh
      run: .\Build\step-pack.ps1

    - name: Pack test
      shell: pwsh
      run: .\Build\step-pack-test.ps1

    - name: Artifact nuget packages
      uses: actions/upload-artifact@v2
      with:
        name: nuget-packages
        path: |
          .\build-out\*.nupkg
          .\build-out\*.snupkg
